"""
ASGI entrypoint. Configures Django and then runs the application
defined in the ASGI_APPLICATION setting.
"""
import os
import django
from decouple import config
from channels.routing import get_default_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'ChatServerPlayground.settings')
django.setup()
asgi_app = get_default_application()
from channels.auth import AuthMiddlewareStack
from channels.routing import ProtocolTypeRouter, URLRouter
from channels.security.websocket import AllowedHostsOriginValidator
from django.urls import path, re_path

from public_chat.consumers import PublicChatConsumer
from chat.consumers import ChatConsumer
from django.conf.urls import url
#import ChatServerPlayground.routing.application
#os.environ.setdefault("DJANGO_SETTINGS_MODULE", f'{config("PROJECT_NAME")}.settings')
#os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'ChatServerPlayground.settings')
django.setup()
#application = get_default_application()

application = ProtocolTypeRouter({
	'https': asgi_app,
        'websocket': AuthMiddlewareStack(
			URLRouter(
				ChatServerPlayground.websocket.routing.websocket_urlpatterns
			)
        )
})
